<!DOCTYPE html>
<html ng-app="d2h_App" ng-app lang="ca">
<head>
    <meta charset="utf-8">

    <link href="../outside/bootstrap-3.3.6-dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="../outside/angular-ui/ui-select-0.13.2/dist/select.min.css" rel="stylesheet">
    <style type="text/css">
    a {cursor: pointer;}
    span.glyphicon.d2h_sortActivated {color:red}
    label {font-weight:	normal;} /* remove font-weight:bold form Bootstrap */
    /**
     * [ng-cloak] is used to prevent show templates, see:
     * https://docs.angularjs.org/api/ng/directive/ngCloak
     */
    [ng-cloak] {  display: none !important; }
    .red {color:red}
    
    /**
     * Validations colors
    .ng-invalid.ng-dirty {
        border-color: red
    }
    .ng-valid.ng-dirty {
        border-color: green
    }
     */
    
    </style>
    <script src="../outside/angular-1.4.8/angular.min.js"></script>
    <script src="../outside/angular-1.4.8/angular-sanitize.min.js"></script>
    <script src="../outside/angular-1.4.8/i18n/angular-locale_ca.js"></script>
    <script src="../outside/angular-ui/ui-bootstrap-tpls-1.0.3.min.js"></script>
    <script src="../outside/angular-ui/ui-select-0.13.2/dist/select.min.js"></script>
    <script>
        var d2h_App = angular.module('d2h_App', ['ui.bootstrap', 'ngSanitize', 'ui.select']);
        var d2h_local = {};
    </script>

    <title>Simple Datagrid with search, sort and paging using AngularJS, PHP, MySQL</title>
</head>
<body>
    <div class="container">
    <pre>{
    "grid": {
        "table": "..\/code\/templates\/angular2\\tables\\.\\paged.html",
        "table.js": "..\/code\/templates\/angular2\\tables\\.\\paged.js",
        "form_page": {
            "form": "..\/code\/templates\/angular2\\tables\\..\\forms\\page.html",
            "inputs": {
                "text": "..\/code\/templates\/angular2\\tables\\..\\forms\/inputs\\.\\text.html",
                "select": "..\/code\/templates\/angular2\\tables\\..\\forms\/inputs\\.\\select.html",
                "ui-select": "..\/code\/templates\/angular2\\tables\\..\\forms\/inputs\\.\\ui-select.html"
            }
        },
        "form_filter": {
            "form": "..\/code\/templates\/angular2\\tables\\..\\forms\\filter.html",
            "inputs": {
                "text": "..\/code\/templates\/angular2\\tables\\..\\forms\/inputs\\.\\text.html",
                "select": "..\/code\/templates\/angular2\\tables\\..\\forms\/inputs\\.\\select.html",
                "ui-select": "..\/code\/templates\/angular2\\tables\\..\\forms\/inputs\\.\\ui-select.html"
            }
        },
        "columns": {
            "sortable": "..\/code\/templates\/angular2\\tables\\columns\\sortable.html"
        }
    }
}</pre><div ng-controller="d2h_1">

<!-- START renderForm({"form_filter") formId="d2h_5" -->
<!-- ======================================== -->
<div class="row" ng-controller="d2h_5">
    <form name="d2h_5" class="simple-form" xx-class="form-horizontal"  novalidate>
    <div>
        <div class="col-md-3">$$Filter:
            <input type="text" placeholder="Filter" 
                class="form-control" 
                ng-model="search"
                required
            />
        </div>
        
            <ui-select
                ng-model="d2h_filter.account_id_EQ"
                name="d2h_6
                ng-controller="d2h_6"
                theme="bootstrap"
                ng-change="changed()"
                ng-init="d2h_filter.account_id_EQ=1005"
    required
            >   <ui-select-match
                    allow-clear="true"
                    placeholder="account_id_EQ"
                >{{$select.selected.text}}</ui-select-match>
                <ui-select-choices 
                    repeat="item.value as item in data | filter: {text: $select.search}">
                    <span ng-bind-html="item.text | highlight: $select.search"></span>
                </ui-select-choices>
            </ui-select>
<script>
    d2h_App.controller('d2h_6', function($scope, $http) {
        $scope.item = {};
        $http({
            method: 'POST',
            url: '_controller.php?model=aixada_ufs:account&lang=ca',
            headers: {
                'Content-Type': undefined
            },
            data: {d2h_oper: 'read'}
        }).then(
            function(response) { // Ok
                $scope.data = response.data.rows;
            }, function(response) { // Error
                console.log(response.status);
            }
        );
    });
</script>

<input type="text" class="form-control" 
    ng-model="d2h_filter.description_LK" ng-init="d2h_filter.description_LK=undefined"
    ng-change="changed()"
    placeholder="description_LK"
    name="d2h_7"
    required
>

        <span class="col-md-1 form-group">
            <br>
            <button class="btn btn-default"
                title="$$Clear filter"
                ng-click="clear()"
            >
                <span class="glyphicon glyphicon-remove"
                    aria-hidden="true"></span>
                <!-- span class="hidden-xs hidden-sm">$$Clear filter</span -->
            </button>
        </span>
    </div>
    </form>
    <div>$$Vallid {{d2h_5.$valid}}</div>
</div>
<script>
    d2h_App.controller('d2h_5', ['$scope', function($scope) {
        $scope.clear = function() {
            $scope.d2h_filter={};
        };
        $scope.changed = function() {
            $scope.readPage();
        };
    }]);
</script>


<!-- END renderForm({"form_filter") formId="d2h_5" -->

<div class="row">
    <div class="col-md-12" id="d2h_1">
        <h3>Diners</h3>
        <table class="table table-striped table-bordered">
            <thead><tr>
                <th>id <a
    title="ordre creixent"
    ng-click="sortBy('id', false);"><span
    aria-label="ordre creixent" aria-hidden="true"
    ng-class="{d2h_sortActivated: predicate=='id' && !reverse}"
    class="glyphicon glyphicon-sort-by-alphabet"></span></a><a
    title="ordre invers"
    ng-click="sortBy('id', true);"><span
    aria-label="ordre invers" aria-hidden="true"
    ng-class="{d2h_sortActivated: predicate=='id' && reverse}"
    aria-hidden="true"
    class="glyphicon glyphicon-sort-by-alphabet-alt"></span></a></th>
<th>account_id <a
    title="ordre creixent"
    ng-click="sortBy('account_id', false);"><span
    aria-label="ordre creixent" aria-hidden="true"
    ng-class="{d2h_sortActivated: predicate=='account_id' && !reverse}"
    class="glyphicon glyphicon-sort-by-alphabet"></span></a><a
    title="ordre invers"
    ng-click="sortBy('account_id', true);"><span
    aria-label="ordre invers" aria-hidden="true"
    ng-class="{d2h_sortActivated: predicate=='account_id' && reverse}"
    aria-hidden="true"
    class="glyphicon glyphicon-sort-by-alphabet-alt"></span></a></th>
<th>Usuari <a
    title="ordre creixent"
    ng-click="sortBy('operator', false);"><span
    aria-label="ordre creixent" aria-hidden="true"
    ng-class="{d2h_sortActivated: predicate=='operator' && !reverse}"
    class="glyphicon glyphicon-sort-by-alphabet"></span></a><a
    title="ordre invers"
    ng-click="sortBy('operator', true);"><span
    aria-label="ordre invers" aria-hidden="true"
    ng-class="{d2h_sortActivated: predicate=='operator' && reverse}"
    aria-hidden="true"
    class="glyphicon glyphicon-sort-by-alphabet-alt"></span></a></th>
<th>description <a
    title="ordre creixent"
    ng-click="sortBy('description', false);"><span
    aria-label="ordre creixent" aria-hidden="true"
    ng-class="{d2h_sortActivated: predicate=='description' && !reverse}"
    class="glyphicon glyphicon-sort-by-alphabet"></span></a><a
    title="ordre invers"
    ng-click="sortBy('description', true);"><span
    aria-label="ordre invers" aria-hidden="true"
    ng-class="{d2h_sortActivated: predicate=='description' && reverse}"
    aria-hidden="true"
    class="glyphicon glyphicon-sort-by-alphabet-alt"></span></a></th>
<th>method <a
    title="ordre creixent"
    ng-click="sortBy('method', false);"><span
    aria-label="ordre creixent" aria-hidden="true"
    ng-class="{d2h_sortActivated: predicate=='method' && !reverse}"
    class="glyphicon glyphicon-sort-by-alphabet"></span></a><a
    title="ordre invers"
    ng-click="sortBy('method', true);"><span
    aria-label="ordre invers" aria-hidden="true"
    ng-class="{d2h_sortActivated: predicate=='method' && reverse}"
    aria-hidden="true"
    class="glyphicon glyphicon-sort-by-alphabet-alt"></span></a></th>
<th>quantity <a
    title="ordre creixent"
    ng-click="sortBy('quantity', false);"><span
    aria-label="ordre creixent" aria-hidden="true"
    ng-class="{d2h_sortActivated: predicate=='quantity' && !reverse}"
    class="glyphicon glyphicon-sort-by-alphabet"></span></a><a
    title="ordre invers"
    ng-click="sortBy('quantity', true);"><span
    aria-label="ordre invers" aria-hidden="true"
    ng-class="{d2h_sortActivated: predicate=='quantity' && reverse}"
    aria-hidden="true"
    class="glyphicon glyphicon-sort-by-alphabet-alt"></span></a></th>
<th>balance <a
    title="ordre creixent"
    ng-click="sortBy('balance', false);"><span
    aria-label="ordre creixent" aria-hidden="true"
    ng-class="{d2h_sortActivated: predicate=='balance' && !reverse}"
    class="glyphicon glyphicon-sort-by-alphabet"></span></a><a
    title="ordre invers"
    ng-click="sortBy('balance', true);"><span
    aria-label="ordre invers" aria-hidden="true"
    ng-class="{d2h_sortActivated: predicate=='balance' && reverse}"
    aria-hidden="true"
    class="glyphicon glyphicon-sort-by-alphabet-alt"></span></a></th>
<th>data <a
    title="ordre creixent"
    ng-click="sortBy('ts', false);"><span
    aria-label="ordre creixent" aria-hidden="true"
    ng-class="{d2h_sortActivated: predicate=='ts' && !reverse}"
    class="glyphicon glyphicon-sort-by-alphabet"></span></a><a
    title="ordre invers"
    ng-click="sortBy('ts', true);"><span
    aria-label="ordre invers" aria-hidden="true"
    ng-class="{d2h_sortActivated: predicate=='ts' && reverse}"
    aria-hidden="true"
    class="glyphicon glyphicon-sort-by-alphabet-alt"></span></a></th>

            </tr></thead>
            <tfoot ng-show="filtered.length > 0" ng-cloak><tr>
                <td colspan="8">
                    
<!-- START renderForm({"form_page") formId="d2h_2" -->
<!-- ======================================== -->
<div class="row" ng-controller="d2h_2">
    <form name="d2h_2" class="simple-form"  novalidate>
        <div>
<ui-select
    ng-controller="d2h_3"
    ng-model="d2h_filter.account_id_EQ" ng-init="d2h_filter.account_id_EQ=1005"
    name="d2h_3"
    theme="bootstrap"
    ng-change="changed()"
    required
>   <ui-select-match
        allow-clear="true"
        placeholder="account_id_EQ"
    >{{$select.selected.text}}</ui-select-match>
    <ui-select-choices 
        repeat="item.value as item in data | filter: {text: $select.search}">
        <span ng-bind-html="item.text | highlight: $select.search"></span>
    </ui-select-choices>
</ui-select>
<script>
    d2h_App.controller('d2h_3', function($scope, $http) {
        $scope.item = {};
        $http({
            method: 'POST',
            url: '_controller.php?model=aixada_ufs:account&lang=ca',
            headers: {
                'Content-Type': undefined
            },
            data: {d2h_oper: 'read'}
        }).then(
            function(response) { // Ok
                $scope.data = response.data.rows;
            }, function(response) { // Error
                console.log(response.status);
            }
        );
    });
</script>

<input type="text" class="form-control" 
    ng-model="d2h_filter.description_LK" ng-init="d2h_filter.description_LK=undefined"
    ng-change="changed()"
    placeholder="description_LK"
    name="d2h_4"
    required
>
</div>
    </form>
</div>
<script>
    d2h_App.controller('d2h_2', ['$scope', function ($scope) {
        var pageSizes = [10, 20, 50, 100];
        $scope.pageSizeOp = [];
        for (i = 0, len = pageSizes.length; i < len; i++) {
            $scope.pageSizeOp.push({
                value: pageSizes[i],
                'text': pageSizes[i]+''
            });
        }
        $scope.changed = function() {
            $scope.readPage();
        };
    }]);
</script>
<!-- END renderForm({"form_page") formId="d2h_2" -->

                </td>
            </tr></tfoot>
            <tbody 
                ng-show="filtered.length > 0" ng-cloak><tr 
                    ng-repeat="item in filtered = (data | filter:search | orderBy :predicate :reverse)">
                <td class="text-right">{{item.id}}</td>
<td class="text-right">{{item.account_id}}</td>
<td>{{item.operator}}</td>
<td>{{item.description}}</td>
<td>{{item.method}}</td>
<td ng-class="{red:item.quantity<0}" class="text-right">{{item.quantity | number:'2'}}</td>
<td ng-class="{red:item.balance<0}" class="text-right">{{item.balance | currency}}</td>
<td>{{item.ts | date:'dd-MM-yy HH:mm'}}</td>

            </tr></tbody>
        </table>
        <div class="alert alert-warning" role="alert"
            ng-show="filtered.length == 0"
        ng-cloak>
            No data found
        </div>
    </div>
</div>
<span ng-init="start()"></span>
</div>
<script>
d2h_App.controller('d2h_1', function ($scope, $http) {
    $scope.d2h_filter={};
    $scope.d2h_page={};
    // server
    var _req = function() {
        return {
            method: 'POST',
            url: '_controller.php?model=aixada_accounts&lang=ca',
            headers: {
                'Content-Type': undefined
            },
            data: {
                d2h_oper: 'read',
                d2h_filter: $scope.d2h_filter,
                d2h_page: $scope.d2h_page
            }
        };
    };
    
    $scope.readPage = function() {
        $scope.d2h_page.pageStart = 1; //current page
        $http(_req()).then(
            function(response) { // Ok
                $scope.data = response.data.rows;
                // $scope.status = response.status;
            }, function(response) { // Error
                // $scope.data = response.data || "Request failed";
                // $scope.status = response.status;
                console.log("IRROR");
            }
        );
    };
    $scope.nextPage = function() {
        $scope.d2h_page.pageStart += $scope.d2h_page.pageSize;
        $http(_req()).then(
            function(response) { // Ok
                Array.prototype.push.apply(
                    $scope.data,
                    response.data.rows
                );
            }, function(response) { // Error
                console.log("IRROR");
            }
        );
    };
    $scope.sortBy = function(predicate, reverse) {
        $scope.predicate = predicate;
        $scope.reverse = reverse;
    };
    $scope.start = function() {
        $scope.readPage();
        $scope.sortBy('id', true);
    };
});
</script>
    </div>
</body>
</html>
